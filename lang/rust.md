# Rust ç¼–ç¨‹è¯­è¨€ (2015-06)

## 1.ä»‹ç»
Rustç‰¹æœ‰çš„æ ¸å¿ƒæ¦‚å¿µï¼š**ownership**

```rust
fn main() {
    let mut x = vec!["Hello", "world"];
    {
        let y = &x[0];
    }
    x.push("foo");
}
```

## 2.èµ·æ­¥

### 2.1.å®‰è£…Rust
**å®‰è£…**ä½¿ç”¨å®˜æ–¹æä¾›çš„å®‰è£…è„šæœ¬ï¼š`rustup.sh`

```sh
$ curl -sf -L https://static.rust-lang.org/rustup.sh | sh
```

**å¸è½½**è„šæœ¬ï¼š`uninstall.sh`

```sh
$ sudo /usr/local/lib/rustlib/uninstall.sh
```

> å®‰è£…æ—¶é‡åˆ°**Rustc: error while loading shared libraries:librustc_driver--4e7c5e5c.so** æ˜¯å› ä¸ºéDebianç³»ç»Ÿé»˜è®¤ä¸ä¿¡ä»» /lib å’Œ /usr/lib , rustå®‰è£…åˆ° /usr/local, **ldconfig**æ— æ³•è¯†åˆ«æ–°å®‰è£…çš„åº“ï¼Œåªéœ€è¦æ‰§è¡Œ `sudo ldconfig /usr/local/lib` å³å¯ã€‚ è¯¦è§ [https://github.com/rust-lang/rust/issues/24677](https://github.com/rust-lang/rust/issues/24677)

### 2.2.Hello, world
Rustä¸é™åˆ¶ä»£ç å­˜æ”¾è·¯å¾„ã€‚

```sh
$ mkdir ~/projects
$ cd ~/projects
$ mkdir hello_world
$ cd hello_world
$ touch main.rs
```

åœ¨ `main.rs` ä¸­ï¼š

```rust
fn main() {
    println!("Hello, world!");
}
```

```sh
$ rustc main.rs
$ ./main
```

è¯´æ˜ï¼š

1. å‘½å `hello_world.rs` ä¼˜äº `helloworld.rs`.
2. èŠ±æ‹¬å·ä¸å‡½æ•°å£°æ˜åŒè¡Œï¼Œå¹¶ç©ºä¸€ä¸ªç©ºæ ¼ã€‚
3. ç¼©è¿›ä½¿ç”¨å››ä¸ªç©ºæ ¼è€Œétab.
4. `println!()` è¡¨ç¤ºè°ƒç”¨ `macro`, å®ƒæ˜¯ï¼²ustçš„å…ƒç¼–ç¨‹ï¼Œæ™®é€šå‡½æ•°å½¢å¦‚ `println()`.
5. Rustæ˜¯è¡¨è¾¾å¼å¯¼å‘å‹è¯­è¨€ï¼Œè¡¨è¾¾å¼ä»¥ `;` ç»“æŸã€‚

## 3.å­¦ä¹ Rust

## 4.Rustæœ‰æ•ˆç¼–ç¨‹

## 5.è¯­æ³•

### 5.1.å˜é‡ç»‘å®š (Variable Bindings)

```rust
fn main() {
    let x = 5;
}
```

`let` è¡¨è¾¾å¼å·¦ä¾§æ˜¯ä¸€ä¸ª `pattern` è€Œéå•çº¯çš„å˜é‡åã€‚
ä¾‹å¦‚ä¸‹é¢å¼å­æ‰§è¡Œå x ä¸º 1 ï¼Œy ä¸º 2 ï¼š

```rust
let (x, y) = (1, 2);
```

Rustæ˜¯é™æ€è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æœŸç¡®å®šç±»å‹ã€‚ä½†æ˜¯å®ƒå¯ä»¥è¿›è¡Œç±»å‹æ¨æ–­ï¼Œå› æ­¤å¯ä»¥çœç•¥ç±»å‹ã€‚
æ˜ç¡®çš„ç±»å‹å£°æ˜ä½¿ç”¨å†’å·ï¼š

```rust
let x: i32 = 5;
```

> `i` è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ï¼Œ `u` è¡¨ç¤ºæ— ç¬¦å·æ•´æ•°:

> i8, i16, i32, i64, 
> u8, u16, u32, u64

é»˜è®¤æƒ…å†µä¸‹ç»‘å®šæ˜¯**ä¸å¯å˜ (immutable)**çš„(å…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› æ˜¯å®‰å…¨)ï¼Œ
å¯å˜ç»‘å®šå¯ä½¿ç”¨ `mut` ï¼š

```rust
let mut x = 5; // mut x: i32
x = 10;
```

å˜é‡ç»‘å®šä½¿ç”¨å‰å¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚æœªåˆå§‹åŒ–ä½†æœªä½¿ç”¨çš„å˜é‡ç¼–è¯‘æ—¶ä¼šæŠ¥è­¦å‘Šã€‚


### 5.2.å‡½æ•° (Functions)

Rustç¨‹åºè‡³å°‘åŒ…å«ä¸€ä¸ª `main `å‡½æ•°ï¼š

```rust
fn main() {
}
```

ä½¿ç”¨ `fn` è¿›è¡Œå‡½æ•°å£°æ˜ï¼Œä¸€ä¸ªå¸¦å‚æ•°çš„å‡½æ•°ï¼š

```rust
fn print_number(x: i32) {
    println!("x is: {}", x);
}
```

å‚æ•°å¿…é¡»æŒ‡æ˜ç±»å‹, å¤šä¸ªå‚æ•°ç”¨é€—å·åˆ†éš”ã€‚

è¿”å›å€¼çš„ç±»å‹ä½¿ç”¨ `->` ç¬¦å·æŒ‡å®šï¼š

```rust
fn add_one(x: i32) -> i32 {
    x + 1
}
```

Ruståªå…è®¸å•ä¸€è¿”å›å€¼ï¼Œæœ€åä¸€è¡Œä»£è¡¨è¿”å›å€¼ã€‚**æ³¨æ„ï¼š æ²¡æœ‰åˆ†å·ï¼**

#### è¡¨è¾¾å¼å’Œè¯­å¥

Rustæ˜¯åŸºäºè¡¨è¾¾å¼çš„è¯­è¨€ï¼Œå®ƒåªæœ‰ä¸¤ç§è¯­å¥ï¼Œå…¶å®ƒå‡ä¸ºè¡¨è¾¾å¼ã€‚

__1) å£°æ˜è¯­å¥ (declaration statement)__

Rustä¸­ `let` å˜é‡ç»‘å®š**ä¸èƒ½**æ¥è¡¨è¾¾å¼, åªèƒ½æ˜¯è¯­å¥ã€‚

èµ‹å€¼è¯­å¥çš„å€¼æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ `()`ï¼Œè€Œéå€¼æœ¬èº«(å°½ç®¡è¿™å¯èƒ½æ²¡ä»€ä¹ˆç”¨)ï¼š

```rust
let mut y = 5;
let x = (y = 6);  // x å€¼ä¸º `()`, è€Œé `6`
```

__2) è¡¨è¾¾å¼è¯­å¥ (expression statement)__

ç›®çš„æ˜¯å°†è¡¨è¾¾å¼è½¬æ¢ä¸ºè¯­å¥; Rustçš„è¯­æ³•è®¤ä¸ºè¯­å¥åé¢åº”è¯¥è¿˜æ˜¯è¯­å¥ï¼Œä¸åŒè¡¨è¾¾å¼é—´ç”¨åˆ†å·åˆ†éš”ã€‚

#### æå‰è¿”å›

æå‰è¿”å›ç»“æœä½¿ç”¨ `return` å…³é”®å­—ï¼š

```rust
fn foo(x: i32) -> i32 {
    return x;
    // ä¸ä¼šæ‰§è¡Œ
    x + 1
}
```

`return` ç”¨åœ¨æœ€åä¸€è¡Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†è¿™è¢«è®¤ä¸ºæ˜¯ç³Ÿç³•çš„ç¼–ç é£æ ¼ã€‚

```rust
// poor style:
fn foo(x: i32) -> i32 {
    return x + 1;
}
```

#### Diverging functions

ä¸€ç§ç‰¹æ®Šè¯­æ³• `diverging functions` :

```rust
fn diverges() -> ! {
    panic!("This function never returns!");
}
```

> å® `panic!` ä¼šå¯¼è‡´å½“å‰æ‰§è¡Œçº¿ç¨‹crashæ‰ã€‚
> ç”±äºå‡½æ•°æ°¸è¿œæ²¡æœ‰è¿”å›å€¼ï¼Œæ•…ç±»å‹ä¸º `!` (è¯»ä½œ diverges)

è¯¥å‡½æ•°å¯ä»¥è¢«ç”¨ä½œä»»æ„ç±»å‹ï¼š

```rust
let x: i32 = diverges();
let x: String = diverges();
```

### 5.3.åŸç”Ÿç±»å‹ (Primitive Types)

Rustæä¾›äº†ä¸€äº›è¯­è¨€å†…å»ºçš„åŸç”Ÿç±»å‹ï¼Œå¦ä¸€äº›æ ‡å‡†åº“ä¸­æä¾›çš„å®ç”¨ç±»å‹åˆ™æ˜¯æ„å»ºåœ¨åŸç”Ÿç±»å‹ä¹‹ä¸Šã€‚

#### å¸ƒå°” (Booleans)

`bool` ç±»å‹æœ‰ä¸¤ä¸ªå€¼ï¼š `true` å’Œ `false`

```rust
let x = true;
let y: bool = false;
```

#### å­—ç¬¦ (char)

`char` ç±»å‹é€šè¿‡å•å¼•å· `'` åˆ›å»ºï¼š

```rust
let x = 'x';
let two_hearts = 'ğŸ’•';
```

Rustçš„charç±»å‹å¹¶éä¸€ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯å››ä¸ªå­—èŠ‚ã€‚

#### æ•°å­—ç±»å‹

* i8
* i16
* i32
* i64
* u8
* u16
* u32
* u64
* isize
* usize
* f32
* f64

é»˜è®¤ç±»å‹ï¼š

```rust
let x = 42;  // i32
let y = 1.0; // f64
```

åˆ†ç±»ï¼š

* æœ‰ç¬¦å· / æ— ç¬¦å·ï¼š i32, u8
* å›ºå®šå¤§å° / å¯å˜å¤§å°ï¼š u32, isize
* æµ®ç‚¹: f32, f64

> å¯å˜å¤§å°çš„æ•°å­—ç±»å‹ï¼Œå…¶å¤§å°åŸºäºåº•å±‚æœºå™¨çš„æŒ‡é’ˆå¤§å°ã€‚

#### æ•°ç»„ (Arrays)

æ•°ç»„é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼š

```rust
let a = [1, 2, 3];
let mut m = [1, 2, 3];
```

æ•°ç»„ç±»å‹ä¸º `[T; N]` , å…¶ä¸­ `N` ä¸ºç¼–è¯‘æœŸå¸¸é‡, ä»£è¡¨æ•°ç»„çš„é•¿åº¦ã€‚

å°†æ•°ç»„å…¨éƒ¨åˆå§‹åŒ–ä¸º 0 çš„ç®€åŒ–å†™æ³•ï¼š

```rust
let a = [0; 20];
```

å¯é€šè¿‡ `len()` è·å–æ•°ç»„é•¿åº¦ï¼š

```rust
let a = [1, 2, 3];
println!("a has {} elements.", a.len());
```

å¯é€šè¿‡ä¸‹æ ‡ç¬¦å·è·å–ç‰¹å®šçš„æ•°ç»„å…ƒç´ (ä¸‹æ ‡ä» **0** å¼€å§‹)ï¼š

```rust
let names = ["Graydon", "Brian", "Niko"]; // names: [&str; 3]
println!("The second name is: {}", names[1]);
```

#### åˆ‡ç‰‡ (Slices)

åˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œé€šå¸¸ä¸ä¼šç›´æ¥åˆ›å»ºã€‚å¯å˜æˆ–ä¸å˜ç±»å‹å‡å¯:

```rust
let a = [0, 1, 2, 3, 4];
let middle = &a[1..4];   // 1, 2, 3
let complete = &a[..];
```

åˆ‡ç‰‡ç±»å‹ä¸º `&[T]` .

#### str

`str` æ˜¯Rustæœ€åŸç”Ÿçš„å­—ç¬¦ä¸²ç±»å‹ã€‚è‡ªèº«å¹¶æ²¡ä»€ä¹ˆä½œç”¨ï¼Œé€šå¸¸ä½œä¸ºå¼•ç”¨ä½¿ç”¨ï¼š `&str`.

#### å…ƒç»„ (Tuples)

å…ƒç»„æ˜¯æŒ‡å›ºå®šå¤§å°çš„æœ‰åºåˆ—è¡¨ï¼š

```rust
let x = (1, "hello");
```

åŠ ä¸Šç±»å‹åæ˜¯è¿™æ ·ï¼š

```rust
let x: (i32, &str) = (1, "hello");
```

ç±»å‹åŠå‚æ•°æ•°é‡ç›¸åŒæ—¶ï¼Œå…ƒç»„å¯ä»¥èµ‹å€¼ï¼š

```rust
let mut x = (1, 2);
let y = (2, 3);

x = y;
```

destructuring let:

```rust
let (x, y, z) = (1, 2, 3);
println!("x is {}", x);
```

åŒºåˆ†ï¼š

```rust
(0,);   // å•å…ƒç´ å…ƒç»„
(0);    // æ‹¬å·ä¸­çš„ 0
```

å…ƒç»„ç´¢å¼•ï¼š

```rust
let tuple = (1, 2, 3);
let x = tuple.0;
let y = tuple.1;
let z = tuple.2;
println!("x is {}"ï¼Œx);
```

#### å‡½æ•°

å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼š

```rust
fn foo(x: i32) -> i32 { x }
let x: fn(i32) -> i32 = foo;
```

ä¾‹å­ä¸­ï¼Œx æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå ç”¨i32è¿”å›i32.


### 5.4.æ³¨é‡Š (Comments)


### 5.5.if

### 5.6.for

### 5.7.while

### 5.8.æ‰€æœ‰æƒ (Ownership)

### 5.9.å¼•ç”¨å’Œå€Ÿç”¨ (References and Borrowing)

### 5.10.ä½¿ç”¨æœŸ (Lifetimes)












